# AGENT.md

本文件面向在 `choice-handbook/` 中工作的自动化/AI agent 或协作者，说明写作与维护规范。

## 快速开始（读者只看这一段就够）

你要交付的不是“看起来很对”，而是读者能立刻用的 **强结论 + 规则**：

### 工作流路由器（只需 1 条规则）

- **如果用户明确要“穿越者投资判官”**（最大必然性×低估、3–5 年上升空间、政治情境树、收费站产业链图，且要求严格 1–7 输出）→ 走 **Traveler Judge**（命令：`/traveler-judge`）  
  **否则如果是“正在演进的真实事件”**（投资/政策/监管/资本配置/供需/技术拐点）→ 走 **Event Reasoning**（`tools/event_reasoning`，产出 memo/mini06/证据表）  
  **否则如果用户明确要“BTC 式百倍/千倍强结论/终局推演”** → 走 **Framework 06**（命令：`/time-travel-06`；按 `frameworks/06_time_travel_endgame_simulator.md` 固定标题完整输出）  
  **否则（默认）** → 走 **Article Processing**（落盘 `sources` digest + `world_understanding` 主文 + 更新索引）

> Cursor 用户默认入口：优先建议先用 `/inbox`（自动路由到上面几条之一）；只有在你确定类型时才直达 `/article-digest`、`/event-reasoning`、`/traveler-judge`、`/time-travel-06`。

### 约束速查卡（复制这个检查）

写完一篇后，快速检查这 5 项：

| 检查项 | 一句话说明 | 如果做不到 |
|--------|-----------|-----------|
| **结论** | 先说推荐/不推荐/再看看，并说清楚适合谁 | 至少写"需要更多证据"并给验证动作 |
| **退出条件** | 写清楚"何时停止"（用可观测信号，不是情绪） | 至少写"如果 X 信号出现就暂停" |
| **重启条件** | 写清楚"何时再上"（满足哪些证据才允许回来） | 至少写"如果 Y 证据出现就重启" |
| **验证动作** | 给 7 天内能完成的小成本验证（具体动作 + 预期证据） | 至少给一个"最小探针"（48h/7d） |
| **事实核验** | 对关键事实不确定时，先 web search；不然降级为观察名单 | 不确定就标注"不确定"，不要编造 |

---

## Traveler Judge 协议（穿越者投资判官，严格 1–7 输出）

当用户明确要求“穿越者投资判官”（最大必然性×低估，且给定 as-of 日期），优先直接用：

- 框架：`frameworks/07_future_traveler_investing_judge.md`
- 命令：`/traveler-judge`

**硬约束（强制）**：
- 只能使用截至 as-of 日期的公开信息；晚于日期的信息一律不可用
- 数据不全 → 必须用“区间 + 敏感度”，严禁装作确定
- 供需与边际效益必须做量级计算（粗模型可，但要可复盘）
- 政治情境树只做 3 个互斥分支
- 每个方向/标的必须给“可检查”的低估条件（If-Then），除非当次已核验并标注来源与日期
- 最多只允许追问 1 个关键参数（其余用假设+敏感度）

落盘（默认）：
- `world_understanding/traveler_judge_runs/YYYY-MM-DD_<scope>_judge.md`
- 更新 `world_understanding/traveler_judge_runs/README.md` 索引

---

## Article Processing 协议（文章/材料 → sources + world_understanding）

当用户贴的是“文章/材料”，你默认交付：

- **1 个 sources digest**：`sources/YYYY-MM-DD_<slug>_paste.md`（含原文/锚点/可抽取资产/不确定性）  
- **1 个 world_understanding 主文**：`world_understanding/<slug>.md`（把观点翻译成机制/变量/预测/探针/退出重启）  
- **索引更新（强制）**：`sources/README.md` + `world_understanding/README.md`

> 核心口径（知识管理 3.0）：你交付的不是“写得像”，而是把材料送上**可自动化运行的知识生产线**：清洗 → 关联（候选集压缩）→ 重述/合并 → 审计/回滚。

world_understanding 主文的最小骨架（缺一不可）：

- **机制链**：用箭头写 `<问题> -> <机制1> -> <机制2> -> <影响>`  
- **变量表（≤10）**：哪些一阶变量决定成败？  
- **情景树（3 条）**：每条必须含 概率/时间窗/触发条件/**observables（可观测指标）**  
- **48h / 7d / 30d 探针**：用最小成本去拿“能改概率”的证据  
- **退出条件 + 重启条件**：用可观测阈值写死（不是情绪）
- **重述/合并（强制工序）**：  
  - 从旧库抽取 2–3 个相关节点（或相互矛盾的节点）  
  - 写出一段“合并后的新表述”（在新语境下重写，而不是拼贴）  
  - 标注 1 个冲突点 + 1 个最小探针（出现什么证据就能解决冲突/改概率）

---

## 真实事件推理（Event Reasoning）协议（面向 Cursor 用户，强制）

当用户的目标是“用推理预测正在演进的真实事件”（常见：投资/政策/监管/制裁/出口管制/地缘政治冲击），优先用：

- `tools/event_reasoning/README.md`
- `tools/event_reasoning/src/event_reasoning/run.py`

### 交互契约（Cursor 用户视角）

Cursor 用户通常不会先写 YAML。你需要把交互做成“自然语言 → 可执行产物”：

- **你必须产出**：一个 `tools/event_reasoning/examples/<event_id>.yaml`
- **你必须运行**：`run.py --input <yaml>`
- **你必须回传**：3 个输出文件路径（sources digest / IC memo / mini06）

### Gate 的口径（必须写清，防误读）

- **Gate = 注意力/仓位口径**，不是“官方确认/已经坐实”。
- Gate 由两类证据共同决定：
  - **Support evidence**：支持主论点的证据强度
  - **Counter evidence**：反证主论点的证据强度（通过 `counter_evidence` tag 标记）
- **强反证存在时不得 Gate 3**：即使支持证据很强，只要出现同等级强反证，就必须降到 Gate 2（继续跟踪 + 条件动作）。

### 反证标注规则（强制）

以下类型通常是“反证/制衡信号”，默认应打 `counter_evidence`（除非你能解释它实际上在支持主论点）：

- 仍在 “eligible / qualified / approved product list / vetted list” 的公开清单
- 仍在公共项目/政府补贴项目中落地的可核验材料（新闻稿/项目公告/招标结果等）

### 最小字段门槛（缺了就不能输出预测）

如果用户没给齐，你必须追问并补齐到 YAML：

- `event.event_type`：优先在 `regulatory / macro_policy / capital_allocation_signal / supply_demand_shock / tech_breakthrough` 中选一类（不确定则写 n/a 并说明理由）
- `thesis.scenarios`：至少 3 个（base/bull/bear），带概率 + 时间窗 + 触发条件 + **observables（可观测指标）**
- `thesis.tripwire` / `thesis.bound`：可观测、可执行（文件/名单/条款/合同层信号）
- `thesis.probes`：48h/7d/30d 的最小探针（去拿“能改变概率”的证据）

### 核心要求（详细版）

- **结论先行**：强烈推荐 / 强烈不推荐 / 观察名单（写置信度：20/50/80）+ 适用边界
- **必须可证伪**：至少 3 条反证信号（出现就降级/退出）
- **必须可退出**：退出条件 + 重启条件（用可观测信号定义，不是情绪）
- **必须可复盘**：给 7 天内最小验证动作（把确定性往上推）
- **强结论要核验**：对 ticker/ETF/关键事实不确定时，先 web search；不然降级为观察名单

## 新项目/新仓库分析协议（强制）

当用户给出一个“新项目/新仓库/新产品”（例如一个 GitHub repo）并要求分析时，必须额外交付两件事：

1) **Evidence Snapshot（必须）**：新增一个 `sources/YYYY-MM-DD_<name>_github_repo_snapshot.md`（或同等命名）作为一手可核验锚点。  
2) **Framework 06（必须过一遍）**：用 `frameworks/06_time_travel_endgame_simulator.md` 的固定标题跑一遍（可以短，但**标题不能省**），并至少给出：Gate、Endgame Map、停止机制、最短探针、Hard Forcing Functions。

### 新 repo 协议：极小 Checklist（强制）

写完后必须能勾完这 2 组检查：

- **Snapshot 文件必含 5 项字段**：
  - [ ] repo URL（可回查）  
  - [ ] license（以 repo 为准）  
  - [ ] stars/forks（注明日期）  
  - [ ] 运行入口/关键架构（README 可核验的部分）  
  - [ ] Delta：对既有分析的影响（把不确定性收敛到 1–3 条）  
- **world_understanding 主文必须链回 snapshot**：
  - [ ] `world_understanding/<topic>.md` 的开头信息区（标题下方/blockquote 处）必须包含：`sources/YYYY-MM-DD_<name>_github_repo_snapshot.md`

## 目标
- 把“选择”写成**可执行、可复盘、可持续迭代**的手册，而不是观点集合。
- 保持结构化与可检索：读者能快速定位“我该怎么做”。
- 允许更有趣的表达：用“未来研究员/未来回看者”的视角写，但必须**落回可证伪的信号与行动**（避免变成纯文学）。

## “BTC 级强结论”协议（强制）

允许“强”，但必须“可证伪、可退出、可复盘”；否则一律降级为观察名单。

### Time-Travel Extreme Thinker（可选，但当用户要求 BTC 式推演时默认启用）

- 用 `frameworks/06_time_travel_endgame_simulator.md` 的固定输出格式做一次完整推演（T0→Now、Endgame Map、Belief Flywheel、Gate 1/2/3）。  
- 三视角必须出现：穿越者（T0）、机制（经济学×博弈论×社会动力学）、上帝（盲点与最短通关路径）；并给“七层共振检查”的 Yes/No 结论。  
- 涉及价格/市值/链上/用户/融资/政策/版本/人物职务等时变信息：必须 web search 核验并标注日期；否则不得 Gate 3。

> 补充：当用户明确要求“过一次 framework 6 / 按 06 来”，或任务属于“新项目/新仓库分析”，即使用户没有说 BTC，也必须按 06 的固定标题完整输出（允许短，但不许跳标题）。

## 年鉴/Case Atlas（类比与门禁）使用协议（强制）

当你要在 `world_understanding/` 中写 **T0-Analog / 类比回放**，或用户明确要“更多案例/更全面案例”时，必须用 Case Atlas 的**新结构**，避免把读者带进 4 份文件的迷宫：

- **只读一次的使用说明（不是案例库）**：  
  - `world_understanding/yearbook/case_atlas_financial_platform_supplychain_framework06.md`
- **核心三分册（11–13，从速用索引开始）**：  
  - 金融危机（编号 `11.x`）：`world_understanding/yearbook/case_atlas_financial_crisis_06.md`  
  - 平台战争（编号 `12.x`）：`world_understanding/yearbook/case_atlas_platform_wars_06.md`  
  - 供应链与制造（编号 `13.x`）：`world_understanding/yearbook/case_atlas_supply_chain_manufacturing_06.md`
- **扩展分册（14–34）**：见 `world_understanding/yearbook/README.md` 的扩展分册清单（用法完全一致）。

### 最小用法（必须照做）

1) 先判你当前问题属于哪类分册（11–34：金融/平台/供应链/或扩展行业）。  
2) 打开对应分册，看 `速用索引` 选 2–3 个结构类比。  
3) 对每个类比只抄 3 件：**First Tripwire / Catastrophic Bound / Death Spiral**（不要整页抄）。  
4) 只留 1 条 **最短探针（48h/7d/30d）**：行动 + 可观测信号 + 退出阈值（写死）。  
> 统一应用方法详见：`world_understanding/yearbook/case_atlas_usage_template.md`。

### 何时允许“强烈推荐 / 强烈不推荐”

只有当你同时满足下面 3 个门槛时，才允许输出强结论（默认目标：80%）：

- **硬约束**：结论主要来自物理/数学/制度/激励结构等“不易被短期改写”的约束（不是情绪与故事）。
- **复利机制**：存在自我增强回路（网络效应/规模效应/学习曲线/分发优势/锁定效应），且能解释为何会越走越强。
- **生存性（对抗世界也能活）**：即使被误解/打压/竞争/监管，仍能通过结构性方式存活（或变体扩散/去中心化/可迁移）。

若任一门槛不满足：输出必须降级为 **观察名单** 或 **需要更多证据**（并给最小验证动作）。

### 强结论必须交付的“6 件套”

当你输出“强烈推荐/强烈不推荐”时，必须包含：

- **结论**：强烈推荐 / 强烈不推荐 / 观察名单（给出置信度：20/50/80）。
- **押什么不变量**：用 3–5 条写清“硬约束 + 机制复利 + 生存性”。
- **反证信号（至少 3 条）**：出现就必须降级/退出（可观测、可执行）。
- **退出条件 + 重启条件**：停机点写成阈值；重启写成证据门槛。
- **最小验证动作（7 天内）**：用小成本把确定性从 20/50 推到 50/80。
- **适用边界**：这结论适用于什么人/账户/时间窗；不适用在哪些条件下。

> 特别提醒：对资产类话题，**“确定性高”指的是机制与生存性更确定**，不等于“价格路径确定”。输出必须把这两者分开写清。

## 内容与格式规范
- **语言**：简体中文为主；必要时保留英文关键词（如 option value / premortem）。
- **命名**：文件名使用 `snake_case.md`，不要空格/大写。
- **输入材料类型**：用户可能给采访/论文/文章/随笔/帖子/纪要/报告等；你需要能先做高质量分类，再做分析与产出。
- **叙事与历史代入（默认能力）**：
  - **未来人视角（hybrid）**：允许更强的镜头感与故事感，但每个关键推演必须落回：事实/假设/推演标签 + 可回归信号 + 可执行下一步。
  - **年代代入**：回看历史时，要写清“当时的人处在什么年代背景、能看到什么/看不到什么、有哪些可选路径与代价”；并显式区分“当时信息”与“事后上帝视角”。
- **默认写作模板（精简版，优先短而密）**：
  1. 概述（这篇解决什么选择/误区）
  2. 结论（强烈推荐/强烈不推荐/观察名单/需要更多证据）+ 置信度 + 适用边界
  3. 框架/模型（1–3 个，给出使用条件）
  4. 关键推演（可选）：若需要“降维/类比/情景”，只写 3–5 条要点 + 观察信号；细节链接到 `frameworks/05_reasoning_toolkit.md`
  5. 尽头坐标（可选）：现实停止处 + 退出/重启条件（能写清就写，写不清不要水）
  6. 下一步（最小动作）：时间盒 + 阈值/记录方式
  7. 可投資標的（仅当 `world_understanding/` 或明显涉资产定价时）：Long/Hedge/Short + 观察信号（保持短）
  8. 参考/延伸（需要时）

### world_understanding/ 的“年代镜头三段”（默认应出现）

为让内容更有趣且更“确定”，`world_understanding/` 建议显式加入并写实写满：

- `## 年代镜头（当时的人看到什么）`：当时的约束/主流信念/可见信号/盲区
- `## 分叉点（当时可选的路径与代价）`：至少 2–3 条路径，各自代价与当时会如何下注
- `## 收敛（我更确定的未来来自哪里）`：用“机制不变量 + 约束 + 观察信号”写成 3–5 条

## 防膨胀规则（强制精简）

- **每个二级标题尽量 ≤ 10 行**；能用 3–5 条 bullet 写完就不要写 15 条
- **通用内容不重复**：如果只是“如何写 Plan Prompt/如何写 MUST 清单”的通用规则，优先链接到 `frameworks/05_reasoning_toolkit.md` 与本文件模板
- **world_understanding 默认写法**：年代镜头/分叉点/收敛要有，但每段 **3–5 条**即可；宁可短也不要水

## “可投資標的”写作标准（避免过少/不精准）

> 目标：把“世界理解”翻译成可执行的交易表达（仍然不构成投资建议）。

- **最小覆盖（默认）**：
  - **Long / Hedge / Short** 三段都要写（除非明确说明“不适用”）
  - **结构不强制**：可以分桶、可以按因子、可以按情景、也可以按“机制链条/约束”来组织；但必须让读者看得出“押什么 → 用什么工具表达”
  - **代表性集合要足够**：优先给 **ETF（篮子）+ 单票（龙头）** 的组合；避免只给 1–2 个示意票
- **精确性规则**：
  - **先说“押什么机制”**，再给标的；每个桶必须能回答“为什么是它/它暴露的是什么因子”
  - 必须写 **篮子 vs 单票** 的使用条件（不想赌单票→ETF；对某机制强信念→少量单票）
  - 必须写 **观察信号 → 标的敏感性**：信号变化时，哪些桶/哪些标的更可能受益或受损
- **可交易性与风险（简要）**：
  - 标的尽量选流动性好、能被多数账户交易的；不确定就篮子化
  - 对冲工具优先用 **指数/行业 ETF 的期权**（put/put spread），并强调限损
- **核验要求（避免写错）**：
  - 当你对 **ticker/交易所/ETF 名称/品类** 不确定时，必须先做 **web search** 核验后再写入（不要凭记忆编造）
  - 如果找不到可靠信息，宁可篮子化或删掉该标的，也不要硬写

## 索引维护（必须同步）
- 新增或改名文档：必须更新对应目录的 `README.md` 索引。
- 根入口变更：同步更新 `choice-handbook/README.md` 的“核心入口/阅读路线”。

## 质量控制（防止空泛）
- 每篇必须提供：**下一步实验**（小成本验证/访问/试运行）至少 1 个。
- 每篇必须提供：**退出条件**（什么时候该停）至少 1 个。
- 不要编造“研究结论/数据/书中原句”。引用外部内容时要给来源（可选）。
> **Plan Prompt** 仅在“需要更长执行指令才能落地”时才写；否则用一句话指向本文件的模板即可，避免每篇重复长提示词。

## 强结论的“事实核验”规则（强制）

- 当你要给出“强烈推荐/强烈不推荐”时：
  - **关键事实必须可追溯**（定义/机制/限制条件/交易标的等）。
  - 对你不确定的关键事实，必须先做 **web search** 核验，再写入（宁可降级为观察名单，也不要凭记忆编造）。

## 证据联结：新材料验证旧猜想（强制）

当有新材料进入，且它的可信度较高、并且**验证/反证**了旧文档中的某个猜想时，必须完成“联结三步”：

1) 更新 `meta/hypotheses_registry.md`：新增或更新对应 `H-XXXX`（状态/置信度/证据链接只追加不覆写）  
2) 回写双向链接：  
   - 在旧文档加一条“证据更新”（链接到新 `sources/` digest 或新 `world_understanding/`）  
   - 在新文档加“关联猜想/关联文档”（链接回旧文档）  
3) 若置信度跨越阈值（例如 50%→80%），更新 `meta/decisions_log.md`：写成可复盘决策（必须含退出/重启条件）

> 置信度口径：参考 `frameworks/05_reasoning_toolkit.md` 的 `C2.4 确定性阶梯（20%/50%/80%）`。

## Plan Prompt 模板（可选，尽量短）

当你需要把“下一步（最小动作）”写成可直接交付给执行代理的指令时，用下面这个单模板（不要在每篇重复多套）：

```
你是执行代理。请在不编造信息的前提下，帮我完成一次“小成本验证/试运行”。

## 背景
<我正在做的选择/文章核心观点/我想验证的假设>

## 目标（要拿到的证据，最好可二选一判定）
- <证据1：是/否/阈值>
- <证据2：是/否/阈值>

## 约束
- 时间盒：<例如 60 分钟 / 7 天>
- 投入上限：<钱/时间/精力>
- 隐私：不要写入任何真实个人隐私或敏感信息

## 你要做的事
1) 把“最危险假设”写成可证伪陈述（3 条以内）
2) 设计最小实验（动作 + 成本 + 预期信号 + 判定标准）
3) 写出退出条件与重启条件（可观测阈值）
4) 输出一段可直接粘贴到 `worksheets/decision_one_pager.md` 的一页总结
```

